<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SAM Speech Synthesizer</title>
    <script src="sam.js"></script>
</head>
<body>
    <script>
        let currentSam = null;
        
        function speakText(text, pitch, speed, mouth, throat) {
            try {
                // Corrected from 'new SAM()' to 'new SamJs()'
                currentSam = new SamJs({
                    pitch: pitch || 64,
                    speed: speed || 72,
                    mouth: mouth || 128,
                    throat: throat || 128
                });
                
                // The sam.js library has its own audio playback system.
                // We will use its built-in speak method.
                currentSam.speak(text).then(() => {
                    // This promise resolves when speech is complete.
                    if (window.Android && typeof window.Android.onSpeechComplete === 'function') {
                        Android.onSpeechComplete();
                    }
                }).catch(e => {
                    if (window.Android && typeof window.Android.onSpeechError === 'function') {
                        Android.onSpeechError(e.toString());
                    }
                });

            } catch(e) {
                if (window.Android && typeof window.Android.onSpeechError === 'function') {
                    Android.onSpeechError(e.toString());
                }
            }
        }
        
        function stopSpeaking() {
            // The library does not provide a direct stop method for the promise-based speak.
            // This would require a more complex implementation if needed.
        }
    </script>
</body>
</html>